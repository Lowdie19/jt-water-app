<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>JT Water Refilling - Admin Inventory</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
/* Reset & Body */
* { margin:0; padding:0; box-sizing:border-box; font-family:Arial,sans-serif; }
body {margin-top: 70px; background: linear-gradient(to bottom, #b2ebf2, #81d4fa); min-height:100vh; overflow-x:hidden; }
@media (min-width: 1024px) { body { padding: 0 30vw; } }

/* Top Bar */
.top-bar { position:fixed; top:0; left:0; right:0; height:60px; background:white; border-bottom:1px solid #ccc; display:flex; align-items:center; justify-content:space-between; padding:0 15px; z-index:1000; }
.top-left { display:flex; align-items:center; gap:10px; }
.hamburger { font-size:22px; cursor:pointer; padding:8px; border-radius:8px; transition:background 0.2s; }
.hamburger:hover { background:#f1f1f1; }
.top-left img { height:35px; }
.top-left h1 { font-family:"Brush Script MT",cursive; color:#0097a7; font-size:22px; }

/* Drawer */
.drawer { position:fixed; top:0; left:-260px; width:260px; height:100%; background:white; box-shadow:2px 0 10px rgba(0,0,0,0.2); border-right:1px solid #ccc; transition:left 0.3s ease; z-index:999; display:flex; flex-direction:column; justify-content:space-between; padding:20px; }
.drawer.open { left:0; }
.drawer-header { display:flex; align-items:center; gap:10px; padding-bottom:10px; }
.drawer-header img { width:40px; height:40px; }
.drawer-header span { font-weight:bold; color:#00acc1; }
.drawer-menu { margin-top:20px; display:flex; flex-direction:column; gap:12px; }
.drawer-menu button { background:#00acc1; color:white; border:none; border-radius:20px; padding:10px 25px; text-align:left; font-size:16px; cursor:pointer; transition:background 0.3s; }
.drawer-menu button:hover { background:#005f8c; }
.drawer-menu button.active { background:#044a6a; }
.drawer-profile { border-top:1px solid #ccc; padding-top:15px; display:flex; align-items:center; gap:12px; }
.drawer-profile img { width:70px; height:70px; border-radius:50%; object-fit:cover; border:3px solid #00acc1; }
.drawer-profile-info { display:flex; flex-direction:column; font-size:16px; color:#8a8a8a; }
.drawer-profile-info b { font-size:18px; color:#00acc1; }
.drawer-bottom { display:flex; flex-direction:column; justify-content:space-between; }
.logout-btn { background:#00d084; color:white; border:none; border-radius:20px; padding:10px 25px; text-align:left; font-size:16px; cursor:pointer; transition:background 0.3s; margin-top:25px; }
.logout-btn:hover { background:#00b070; }

/* Overlay & Modal */
.overlay { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.3); opacity:0; visibility:hidden; transition:opacity 0.3s; z-index:998; }
.overlay.show { opacity:1; visibility:visible; }
.modal { position:fixed; inset:0; background: rgba(0,0,0,0.4); display:none; justify-content:center; align-items:center; z-index:999; padding:16px; }
.modal-content { background:white; border-radius:12px; width:90%; max-width:400px; padding:20px; display:flex; flex-direction:column; align-items:center; gap:12px; box-shadow:0 6px 20px rgba(0,0,0,0.25); }
.modal-content h2 { font-size:22px; color:black; }
.modal-content p { font-size:16px; text-align:center; }
.modal-close { background:#00d084; color:white; border:none; padding:8px 20px; border-radius:6px; cursor:pointer; font-size:16px; font-weight:bold; transition:0.2s; }
.modal-close:hover { background:#00b070; }

/* Inventory Table */
.body-content { margin-top: 30px; padding:0 16px; display:flex; flex-direction:column; gap:16px; }

.inventory-table-container { width:100%; overflow-x:auto; background:white; border-radius:8px; box-shadow:0 3px 8px rgba(0,0,0,0.1); margin-bottom:30px; }
.inventory-table { width:100%; border-collapse:collapse; min-width:600px; }
.inventory-table th, .inventory-table td { text-align:left; padding:12px 16px; border-bottom:1px solid #ddd; font-size:16px; white-space:nowrap; }
.inventory-table th { background-color:#00acc1; color:white; font-size:16px; font-weight:bold;}
.inventory-table tr:hover { background-color:#f1f1f1; }

.inventory-table input {
  width: 120px; /* was 60px, now wider */
  padding: 4px 6px;
  border-radius: 4px;
  border: 1px solid #ccc;
  text-align: center;
  font-size: 16px;
}

/* Action Buttons */
.Action-btn { color:white; border:none; padding:6px 12px; border-radius:6px; font-size:16px; font-weight:bold; cursor:pointer; transition:0.2s; }
.Action-btn.remove { background:#e23737; }
.Action-btn.remove:hover { background:#b71c1c; }
.Action-btn.edit { background:#0097a7; margin-right:5px; }
.Action-btn.edit:hover { background:#006978; }
.add-btn { background:#00d084; color:white; border:none; padding:10px 20px; border-radius:12px; font-size:16px; font-weight:bold; cursor:pointer; transition:0.2s; margin-top:10px; }
.add-btn:hover { background:#00b070; }

.page-title { font-size:22px; font-weight:bold; color:#00acc1; text-align:center; }
</style>
</head>
<body>

<!-- Success Popup -->
<div id="successPopup" style="position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #00d084; color: white; padding: 12px 24px; border-radius: 8px; font-weight: bold; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); display: none; z-index: 2000;">Success!</div>

<!-- Drawer -->
<div class="drawer" id="drawer">
  <div>
    <div class="drawer-header">
      <img src="JT_LOGO.png" alt="Logo" />
      <span>Water Refilling Station</span>
    </div>
    <div class="drawer-menu">
      <button onclick="navigateTo('admin-dashboard.html', this)"><i class="fa-solid fa-chart-line" style="margin-right: 10px;"></i>Dashboard</button>
      <button onclick="navigateTo('admin-sales.html', this)"><i class="fa-solid fa-receipt" style="margin-right: 10px;"></i>Sales</button>
      <button onclick="navigateTo('admin-accounts.html', this)"><i class="fa-solid fa-user" style="margin-right: 10px;"></i>Accounts</button>
      <button onclick="navigateTo('admin-inventory.html', this)" class="active"><i class="fa-solid fa-boxes-stacked" style="margin-right: 10px;"></i>Inventory</button>
    </div>
  </div>
  <div class="drawer-bottom">
    <div class="drawer-profile">
      <img src="Profile-admin.jpg" alt="Admin Profile" />
      <div class="drawer-profile-info">
        <b>Gina Ballares</b>
        <span>Administrator</span>
      </div>
    </div>
    <button class="logout-btn" onclick="openLogoutModal()"><i class="fa-solid fa-right-from-bracket" style="margin-right:8px;"></i>Log Out</button>
  </div>
</div>

<div class="overlay" id="overlay"></div>

<!-- Logout Modal -->
<div id="logoutModal" class="modal">
  <div class="modal-content">
    <h2>Logout</h2>
    <p>Are you sure you want to log out?</p>
    <div style="display:flex; gap:16px;">
      <button class="modal-close" onclick="confirmLogout()">Yes</button>
      <button class="modal-close" onclick="closeLogoutModal()">No</button>
    </div>
  </div>
</div>

<!-- Top Bar -->
<div class="top-bar">
  <div class="top-left">
    <div class="hamburger" id="hamburger">&#9776;</div>
    <img src="JT_LOGO.png" alt="Logo" />
    <h1>Water Refilling Station</h1>
  </div>
</div>

<!-- Page Title -->
<div class="page-title">
  <i class="fa-solid fa-boxes-stacked" style="margin-right: 15px;"></i>INVENTORY
</div>

<!-- Content -->
<div class="content">
  <div class="body-content">
    <div class="inventory-table-container">
      <table class="inventory-table" id="inventoryTable">
        <thead>
          <tr>
            <th>Item Name</th>
            <th>Quantity</th>
            <th>Date Added</th>
            <th style="text-align:center;">Action</th> <!-- Removed Date Placed -->
          </tr>
        </thead>
        <tbody>
        <tr>
          <td>Rectangular Container 18.9L</td>
          <td>50</td>
          <td>2025-11-01</td>
          <td style="text-align:center;">
            <button class="Action-btn edit">Edit</button>
            <button class="Action-btn remove">Remove</button>
          </td>
        </tr>
        <tr>
          <td>Cylindrical Gallon 20L</td>
          <td>30</td>
          <td>2025-11-02</td>
          <td style="text-align:center;">
            <button class="Action-btn edit">Edit</button>
            <button class="Action-btn remove">Remove</button>
          </td>
        </tr>
        <tr>
          <td>Shrink Wraps</td>
          <td>100</td>
          <td>2025-11-05</td>
          <td style="text-align:center;">
            <button class="Action-btn edit">Edit</button>
            <button class="Action-btn remove">Remove</button>
          </td>
        </tr>
      </tbody>
      </table>
    </div>

    <button class="add-btn" onclick="addNewItem()">+ Add New Item</button>
  </div>
</div>

<!-- Edit Confirmation Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <h2>Edit Item</h2>
    <p>Do you want to save the changes?</p>
    <div style="display:flex; gap:16px;">
      <button class="modal-close" onclick="saveEdit()">Yes</button>
      <button class="modal-close" onclick="closeEditModal()">No</button>
    </div>
  </div>
</div>

<!-- Remove Confirmation Modal -->
<div id="removeModal" class="modal">
  <div class="modal-content">
    <h2>Remove Item</h2>
    <p id="removeModalText">Are you sure you want to remove this item?</p>
    <div style="display:flex; gap:16px;">
      <button class="modal-close" id="confirmRemove">Yes</button>
      <button class="modal-close" id="cancelRemove">No</button>
    </div>
  </div>
</div>

<!-- Cancel Edit Confirmation Modal -->
<div id="cancelModal" class="modal">
  <div class="modal-content">
    <h2>Discard Changes</h2>
    <p id="cancelModalText">Are you sure you want to discard changes?</p>
    <div style="display:flex; gap:16px;">
      <button class="modal-close" id="confirmCancel">Yes</button>
      <button class="modal-close" id="cancelCancel">No</button>
    </div>
  </div>
</div>

<script>
// Inline Edit Logic
let editingRow = null;
let originalData = {};
let editBtnCurrent = null;
let newRowEditing = false;
let rowToRemove = null; // store row being removed
let rowToCancel = null; // store row being canceled
let suppressClickModal = false;

// Drawer toggle
const drawer = document.getElementById("drawer");
const overlay = document.getElementById("overlay");
const hamburger = document.getElementById("hamburger");
hamburger.addEventListener("click", () => { 
  drawer.classList.toggle("open"); 
  overlay.classList.toggle("show"); 
});
overlay.addEventListener("click", () => { 
  drawer.classList.remove("open"); 
  overlay.classList.remove("show"); 
});

// Logout Modal
function openLogoutModal() { document.getElementById('logoutModal').style.display='flex'; }
function closeLogoutModal() { document.getElementById('logoutModal').style.display='none'; }
function confirmLogout() { window.location.href="login.html"; }

// Navigation highlight
function navigateTo(url, button){
  const buttons = document.querySelectorAll(".drawer-menu button");
  buttons.forEach(btn => btn.classList.remove("active"));
  button.classList.add("active");
  buttons.forEach(btn => btn.disabled = true);
  setTimeout(() => { window.location.href = url; }, 400);
}

// Success popup
function showSuccessPopup(message) {
  const popup = document.getElementById('successPopup');
  popup.textContent = message;
  popup.style.opacity = 0;
  popup.style.display = 'block';
  setTimeout(() => { 
    popup.style.transition = 'opacity 0.3s';
    popup.style.opacity = 1; 
  }, 50);
  setTimeout(() => { 
    popup.style.opacity = 0;
    popup.addEventListener('transitionend', () => { popup.style.display = 'none'; }, { once: true });
  }, 2000);
}

// Remove buttons with confirmation
function attachRemoveListeners() {
  document.querySelectorAll('.Action-btn.remove').forEach(btn => {
    btn.onclick = () => {
      rowToRemove = btn.closest('tr');
      const itemName = rowToRemove.querySelector('td').textContent || 'this item';
      document.getElementById('removeModalText').textContent = `Are you sure you want to remove "${itemName}"?`;
      document.getElementById('removeModal').style.display = 'flex';
    };
  });
}

// Confirm Remove
document.getElementById('confirmRemove').onclick = () => {
  if (rowToRemove) {
    rowToRemove.remove();
    showSuccessPopup('Item removed successfully!');
    rowToRemove = null;
  }
  document.getElementById('removeModal').style.display = 'none';
};

// Cancel Remove
document.getElementById('cancelRemove').onclick = () => {
  rowToRemove = null;
  document.getElementById('removeModal').style.display = 'none';
};

attachRemoveListeners();



// Start editing a row
function startEditing(row, editBtn, isNew=false) {
  if (editingRow) return;
  editingRow = row;
  editBtnCurrent = editBtn;
  newRowEditing = isNew;

  document.querySelectorAll('.inventory-table th').forEach(th => th.style.backgroundColor = '#00d084');
  document.querySelector('.add-btn').style.display = 'none';

  const cells = row.querySelectorAll('td');
  originalData = {
    name: cells[0].textContent,
    quantity: cells[1].textContent,
    date: cells[2].textContent
  };

  cells[0].innerHTML = `<input type="text" value="${originalData.name}">`;
  cells[1].innerHTML = `<input type="number" value="${originalData.quantity}" min="0">`;
  cells[2].innerHTML = `<input type="date" value="${originalData.date}">`;

  editBtn.textContent = 'Save';
  editBtn.style.background = '#00d084';
  editBtn.onclick = () => stopEditing(true);

  const removeBtn = row.querySelector('.Action-btn.remove');
  removeBtn.textContent = 'Cancel';
  removeBtn.style.background = '#ccc';
  
  // Instead of immediately cancel, open confirmation modal
  removeBtn.onclick = () => {
    rowToCancel = row;
    document.getElementById('cancelModalText').textContent = `Are you sure you want to discard changes for "${originalData.name}"?`;
    document.getElementById('cancelModal').style.display = 'flex';
  };

  cells[0].querySelector('input').focus();
};

// Confirm Cancel
document.getElementById('confirmCancel').onclick = () => {
  if (rowToCancel) stopEditing(false);
  rowToCancel = null;
  document.getElementById('cancelModal').style.display = 'none';
};

// Cancel Cancel
document.getElementById('cancelCancel').onclick = () => {
  rowToCancel = null;
  document.getElementById('cancelModal').style.display = 'none';
};

// Stop editing a row
function stopEditing(saveChanges) {
  if (!editingRow) return;
  const cells = editingRow.querySelectorAll('td');

  if (saveChanges) {
    // Save changes
    cells[0].textContent = cells[0].querySelector('input').value;
    cells[1].textContent = cells[1].querySelector('input').value;
    cells[2].textContent = cells[2].querySelector('input').value;
    showSuccessPopup('Item updated successfully!');
  } else {
    if (newRowEditing) {
      // If it's a new row and cancelled, remove it
      editingRow.remove();
    } else {
      // Revert to original data for existing row
      cells[0].textContent = originalData.name;
      cells[1].textContent = originalData.quantity;
      cells[2].textContent = originalData.date;
    }
  }

  // Revert table header color
  document.querySelectorAll('.inventory-table th').forEach(th => {
    th.style.backgroundColor = '#00acc1';
  });

  // Show Add New Item button again
  document.querySelector('.add-btn').style.display = 'block';

  // Save references before resetting
  const rowRef = editingRow;
  const editBtnRef = editBtnCurrent;

  // Reset flags
  editingRow = null;
  editBtnCurrent = null;
  originalData = {};
  newRowEditing = false;
  closeEditModal();

  if (!saveChanges && rowRef.parentNode == null) return; // Row removed, nothing more to do

  // Re-attach Edit button correctly (only for existing rows)
  const editBtn = rowRef.querySelector('.Action-btn.edit');
  editBtn.textContent = 'Edit';
  editBtn.style.background = '#0097a7';
  editBtn.onclick = () => startEditing(rowRef, editBtn);

  // Re-attach Remove button correctly (only for existing rows)
  const removeBtn = rowRef.querySelector('.Action-btn.remove');
  removeBtn.textContent = 'Remove';
  removeBtn.style.background = '#e23737';
removeBtn.onclick = () => {
  rowToRemove = rowRef;
  const itemName = rowRef.querySelector('td').textContent || 'this item';
  document.getElementById('removeModalText').textContent = `Are you sure you want to remove "${itemName}"?`;
  document.getElementById('removeModal').style.display = 'flex';
};
}

// Attach Edit buttons
function attachEditListeners() {
  document.querySelectorAll('.Action-btn.edit').forEach(btn => {
    btn.onclick = () => {
      const row = btn.closest('tr');
      startEditing(row, btn);
    };
  });
}
attachEditListeners();

// Modal actions
function closeEditModal() { document.getElementById('editModal').style.display = 'none'; }
function saveEdit() { stopEditing(true); }
function discardEdit() { stopEditing(false); }
document.querySelectorAll('#editModal .modal-close').forEach(btn => {
  btn.onclick = () => btn.textContent === 'Yes' ? saveEdit() : discardEdit();
});

// Add New Item
function addNewItem() {
  const tableBody = document.querySelector('#inventoryTable tbody');
  const newRow = document.createElement('tr');
  const today = new Date().toISOString().split('T')[0];

  newRow.innerHTML = `
    <td>New Item</td>
    <td>0</td>
    <td>${today}</td>
    <td style="text-align:center;">
      <button class="Action-btn edit">Edit</button>
      <button class="Action-btn remove">Remove</button>
    </td>
  `;

  tableBody.appendChild(newRow);
  attachRemoveListeners();
  attachEditListeners();

  const editBtn = newRow.querySelector('.Action-btn.edit');
  suppressClickModal = true;
  startEditing(newRow, editBtn, true);
  setTimeout(() => { suppressClickModal = false; }, 100);
}

// Click outside editable row triggers modal
document.addEventListener('click', (e) => {
  if (!editingRow || suppressClickModal) return;

  if (!editingRow.contains(e.target)) {
    document.getElementById('editModal').style.display = 'flex';
  }
});
</script>

<script src="sound.js"></script>
<script src="js-drawer-gesture.js"></script>
</body>
</html>
