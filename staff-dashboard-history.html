<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Staff Dashboard - History</title>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
/>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(to bottom, #b2ebf2, #81d4fa);
  background-attachment: fixed;
  background-repeat: no-repeat;
  background-size: cover;
}

@media (min-width: 1024px) { body { padding: 0 30vw; } }

/* Top Bar */
.top-bar {
  position: fixed; top:0; left:0; right:0;
  display:flex; align-items:center; justify-content:center;
  background:white; padding:12px 0; box-shadow:0 2px 6px rgba(0,0,0,0.1); z-index:10;
}
.top-bar h1 { font-size:22px; color:#00acc1; margin:0; font-weight:bold; }

/* Search + Calendar Bar */
.search-bar { margin-top:60px; display:flex; justify-content:space-between; align-items:center; padding:8px 16px; gap:8px; }
.search-bar input { flex:1; padding:8px 12px; border-radius:25px; border:2px solid #b2ebf2; font-size:14px; }
.search-bar button { background:#00acc1; border:none; border-radius:50%; padding:10px; color:white; font-size:16px; cursor:pointer; transition:0.2s; }
.search-bar button:hover { background:#005f8c; }

.body-content { margin-top:16px; margin-bottom:250px; padding:0 16px; display:flex; flex-direction:column; gap:16px; }

/* Month Divider & Date Divider */
.month-divider, .date-divider { font-weight:bold; color:#005f8c; padding:8px 0; border-top:1px dashed #005f8c; margin-top:12px; }

/* History Order Card */
.history-card { background:white; border-radius:14px; box-shadow:0 3px 10px rgba(0,0,0,0.1); padding:15px; display:flex; flex-direction:column; gap:8px; transition: transform 0.2s ease; }
.history-card:hover { transform:scale(1.02); }
.history-info b { color:#00acc1; }

.status { font-weight:bold; padding:4px 8px; border-radius:12px; width:fit-content; font-size:0.85em; }
.status.accepted { background:#00d084; color:white; }
.status.declined { background:#e74c3c; color:white; }

/* Calendar Modal */
.calendar-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); justify-content:center; align-items:center; z-index:20; }
.calendar-content { background:white; border-radius:15px; width:90%; max-width:340px; padding:20px; text-align:center; box-shadow:0 4px 20px rgba(0,0,0,0.25); }
.calendar-content h3 { margin-top:0; color:#00acc1; }
.calendar-selectors { display:flex; justify-content:center; gap:8px; margin-bottom:10px; }
.calendar-selectors select { padding:6px 12px; border-radius:25px; border:2px solid #b2ebf2; font-size:14px; cursor:pointer; }
.calendar-days { display:grid; grid-template-columns:repeat(7,1fr); gap:5px; margin-top:10px; }
.calendar-days div { padding:8px 0; border-radius:50%; cursor:pointer; transition:0.2s; font-weight:bold; }
.calendar-days div:hover { background:#00d084; color:white; }
.close-calendar { margin-top:12px; padding:6px 12px; border:none; border-radius:20px; background:#ccc; cursor:pointer; }

/* Bottom Navigation */
.bottom-nav { position:fixed; bottom:0; left:0; right:0; background:white; border-top:1px solid #ccc; display:flex; justify-content:space-around; align-items:center; padding:8px 0; box-shadow:0 -2px 6px rgba(0,0,0,0.1); }
.bottom-nav button { background:none; border:none; color:#00acc1; font-size:14px; display:flex; flex-direction:column; align-items:center; cursor:pointer; transition:0.2s; }
@media (min-width:768px) { .bottom-nav { justify-content:center; gap:110px; } }
.bottom-nav button.active { color:#00d084; }
.bottom-nav i { font-size:20px; margin-bottom:4px; }

.close-btn { background:#ccc; color:white; border-radius:25px; padding:10px; border:none; cursor:pointer; }
.close-btn:hover { background:#aaa; }
</style>
</head>
<body>

<div class="top-bar"><h1>Customer Order History</h1></div>

<div class="search-bar">
  <input type="text" id="searchOrders" placeholder="Search orders by customer..." onkeyup="filterOrders()"/>
  <button onclick="playClickSound(); openCalendar()"><i class="fa-solid fa-calendar-days"></i></button>
</div>

<div style="display:flex; justify-content:center; margin:8px 0;">
  <button id="showAllBtn" onclick="animateShowAllOrders()" style="padding:6px 12px; border-radius:20px; background:#00acc1; color:white; border:none; cursor:pointer; font-weight:bold;">Show All Orders</button>
</div>

<div class="body-content" id="historyList">
  <div class="month-divider">January 2025</div>
  <div class="history-card" data-date="2025-01-01">
    <div class="history-info">
      <span class="order-id" style="font-size:0.85em; font-weight:bold; color:#ccc;">ORD341</span><br><br>
      <b>Customer:</b> Camille Tolentino<br>
      <b>Address:</b> Tawiran St., Brgy. Panasahan<br>
      <b>Date:</b> January 1, 2025<br>
      <b>Order Type:</b> <b style="color:black;">DELIVERY</b><br>
      <b>Item:</b> 3 Rectangular Container<br>
    </div>
    <span class="status accepted">Accepted</span>
  </div>
  <div class="history-card" data-date="2025-01-02">
    <div class="history-info">
      <span class="order-id" style="font-size:0.85em; font-weight:bold; color:#ccc;">ORD342</span><br><br>
      <b>Customer:</b> Bea Arcega<br>
      <b>Address:</b> Samapagita St., Brgy. Panasahan<br>
      <b>Date:</b> January 2, 2025<br>
      <b>Order Type:</b> <b style="color:black;">PICKUP</b><br>
      <b>Item:</b> 1 Cylindrical Gallon<br>
    </div>
    <span class="status declined">Declined</span>
  </div>

  <div class="month-divider">February 2025</div>
  <div class="history-card" data-date="2025-02-05">
    <div class="history-info">
      <span class="order-id" style="font-size:0.85em; font-weight:bold; color:#ccc;">ORD360</span><br><br>
      <b>Customer:</b> Kim Liwanag<br>
      <b>Address:</b> Camino St., Brgy. Bagna<br>
      <b>Date:</b> February 5, 2025<br>
      <b>Order Type:</b> <b style="color:black;">DELIVERY</b><br>
      <b>Item:</b> 2 Rectangular Container<br>
    </div>
    <span class="status accepted">Accepted</span>
  </div>
</div>

<div class="calendar-modal" id="calendarModal">
  <div class="calendar-content">
    <h3>Select Date</h3>
    <div class="calendar-selectors">
      <select id="monthSelect" onchange="renderCalendar()"></select>
      <select id="yearSelect" onchange="renderCalendar()"></select>
    </div>
    <div class="calendar-days" id="calendarDays"></div>
    <button class="close-btn" onclick="playClickSound(); closeCalendar()">Cancel</button>
  </div>
</div>

<div class="bottom-nav">
  <button onclick="location.href='staff-dashboard-orders.html'">
    <i class="fa-solid fa-cart-shopping"></i>
    <span>Orders</span>
  </button>
  <button class="active" onclick="location.href='staff-dashboard-history.html'">
    <i class="fa-solid fa-clock-rotate-left"></i>
    <span>History</span>
  </button>
  <button onclick="location.href='staff-dashboard-profile.html'">
    <i class="fa-solid fa-user"></i>
    <span>Profile</span>
  </button>
</div>

<script>
// Click sound
const clickSound = new Audio('click.wav');
function playClickSound(){ clickSound.currentTime=0; clickSound.play().catch(()=>{}); }

// Random Orders
function generateRandomOrders(year, month, day){
  const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
  const names = ["Alice","Bob","Charlie","David","Emma","Fiona","George","Hannah"];
  const addresses = [
    "Samapagita St., Brgy. Panasahan",
    "Tawiran St., Brgy. Panasahan",
    "Camino St., Brgy. Bagna",
    "Torres St., Brgy. Panasahan"
  ];
  const items = ["1 Cylindrical Gallon","2 Rectangular Container","3 Rectangular Container","1 Cylindrical + 2 Rectangular"];
  const types = ["DELIVERY","PICKUP"];
  const statuses = ["accepted","declined"];
  const container = document.getElementById('historyList');

  // Remove old random orders and previous date-divider
  container.querySelectorAll('.random-card,.date-divider').forEach(e=>e.remove());

  // Add Date divider
  const dateDivider = document.createElement('div');
  dateDivider.className='date-divider';
  const dateObj = new Date(year, month, day);
  const options = { month:'long', day:'numeric', year:'numeric' };
  dateDivider.textContent = dateObj.toLocaleDateString('en-US', options); // no "Date:" prefix

  // Insert divider before first card of that month
  const firstMonthCard = Array.from(container.querySelectorAll('.month-divider')).find(div=>{
    return new Date(`${div.textContent} 1`).getMonth() === month;
  });
  if(firstMonthCard) firstMonthCard.after(dateDivider);
  else container.prepend(dateDivider);

  const count = Math.floor(Math.random()*3)+1; // 1-3 random orders
  for(let i=0;i<count;i++){
    const card = document.createElement('div');
    card.classList.add('history-card','random-card');
    card.dataset.date = dateStr;

    const randomName = names[Math.floor(Math.random()*names.length)];
    const randomItem = items[Math.floor(Math.random()*items.length)];
    const randomType = types[Math.floor(Math.random()*types.length)];
    const randomStatus = statuses[Math.floor(Math.random()*statuses.length)];
    const randomAddress = addresses[Math.floor(Math.random()*addresses.length)];
    const orderId = "ORD"+Math.floor(Math.random()*900+100);

    card.innerHTML = `
      <div class="history-info">
        <span class="order-id" style="font-size:0.85em; font-weight:bold; color:#ccc;">${orderId}</span><br><br>
        <b>Customer:</b> ${randomName}<br>
        <b>Address:</b> ${randomAddress}<br>
        <b>Date:</b> ${dateObj.toLocaleDateString('en-US', options)}<br>
        <b>Order Type:</b> <b style="color:black;">${randomType}</b><br>
        <b>Item:</b> ${randomItem}<br>
      </div>
      <span class="status ${randomStatus}">${randomStatus.charAt(0).toUpperCase()+randomStatus.slice(1)}</span>
    `;
    dateDivider.after(card);
  }
}

// Filter Orders
function filterOrders(){
  const query=document.getElementById('searchOrders').value.trim().toLowerCase();
  document.querySelectorAll('.history-card').forEach(card=>{
    const info=card.querySelector('.history-info').innerText.toLowerCase();
    card.style.display= info.includes(query)?'':'none';
  });
  document.querySelectorAll('.month-divider,.date-divider').forEach(div=>{
    let show=false; let next=div.nextElementSibling;
    while(next && next.classList.contains('history-card')){
      if(next.style.display!=='none'){ show=true; break; }
      next=next.nextElementSibling;
    }
    div.style.display=show?'':'none';
  });
}

// Calendar
function openCalendar(){ document.getElementById('calendarModal').style.display='flex'; populateYears(); renderCalendar(); }
function closeCalendar(){ document.getElementById('calendarModal').style.display='none'; }

function populateYears(){
  const yearSelect=document.getElementById('yearSelect'); yearSelect.innerHTML='';
  const currentYear=new Date().getFullYear();
  for(let y=currentYear-5;y<=currentYear+5;y++){ const option=document.createElement('option'); option.value=y; option.textContent=y; if(y===currentYear) option.selected=true; yearSelect.appendChild(option); }
  const monthSelect=document.getElementById('monthSelect'); monthSelect.innerHTML='';
  const monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];
  monthNames.forEach((name,index)=>{ const opt=document.createElement('option'); opt.value=index; opt.textContent=name; if(index===new Date().getMonth()) opt.selected=true; monthSelect.appendChild(opt); });
}

function renderCalendar(){
  const month=parseInt(document.getElementById('monthSelect').value);
  const year=parseInt(document.getElementById('yearSelect').value);
  const container=document.getElementById('calendarDays'); container.innerHTML='';
  const daysInMonth=new Date(year,month+1,0).getDate();
  for(let i=1;i<=daysInMonth;i++){
    const day=document.createElement('div'); day.textContent=i;
    day.onclick=()=>{
      day.style.transition="transform 0.15s ease"; day.style.transform="scale(1.3)";
      setTimeout(()=>{ day.style.transform="scale(1)"; },150);
      playClickSound();
      generateRandomOrders(year,month,i);
      filterByFullDate(year,month,i);
    };
    container.appendChild(day);
  }
}

function filterByFullDate(year,month,day){
  const dateStr=`${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
  document.querySelectorAll('.history-card').forEach(card=>{
    card.style.display = card.dataset.date===dateStr?'':'none';
  });
  document.querySelectorAll('.month-divider,.date-divider').forEach(div=>{
    let show=false; let next=div.nextElementSibling;
    while(next && next.classList.contains('history-card')){
      if(next.style.display!=='none'){ show=true; break; }
      next=next.nextElementSibling;
    }
    div.style.display=show?'':'none';
  });
  animateSelectedDate();
  setTimeout(()=>{ closeCalendar(); },500);
}

function animateSelectedDate(){
  const visibleCards=document.querySelectorAll('.history-card:not([style*="display: none"])');
  visibleCards.forEach(card=>{
    const dateEl=card.querySelector('.history-info b:nth-of-type(3)');
    if(dateEl){ dateEl.style.transition="transform 0.3s ease, color 0.3s ease"; dateEl.style.transform="scale(1.3)"; dateEl.style.color="#00d084"; setTimeout(()=>{ dateEl.style.transform="scale(1)"; dateEl.style.color="#00acc1"; },300); }
  });
}

// Show All Orders animation + sound
function animateShowAllOrders(){
  const btn = document.getElementById('showAllBtn');
  btn.style.transform='scale(1.2)';
  playClickSound();
  setTimeout(()=>{ btn.style.transform='scale(1)'; showAllOrders(); },150);
}

function showAllOrders(){
  document.querySelectorAll('.history-card').forEach(card=>card.style.display='');
  document.querySelectorAll('.month-divider').forEach(div=>div.style.display='');
  document.querySelectorAll('.random-card,.date-divider').forEach(el => el.remove());
  document.getElementById('searchOrders').value='';
}
</script>
</body>
</html>
